# 任务 003: 大纲-正文双向同步（结构绑定）

## 目标

建立“大纲节点 ↔ 正文范围”的稳定绑定：支持从大纲定位正文、从正文定位大纲；绑定失效必须可观测并提供恢复入口，避免大纲与正文脱节导致的编辑迷失。

## 依赖

- Sprint 5：大纲视图与最小定位（至少标题级定位）
- 编辑器范围定位能力（优先支持段落级范围）

## 实现步骤

1. 绑定模型：
   - 为大纲节点引入稳定 id
   - 为正文建立可更新的锚点/范围标识（实现策略可自定，但必须可恢复）
2. 双向定位：
   - 大纲点击 → 定位正文
   - 光标/选区变化 → 高亮对应大纲节点（无法判定则显示未绑定）
3. 绑定修复：
   - 当范围不再可定位时，显示“待修复”状态
   - 提供重新绑定入口（用户显式操作）
4. 低打扰策略：
   - 同步不得造成编辑器卡顿；允许 debounce/批处理

## 验收标准

- [ ] 大纲点击可稳定定位到绑定正文范围（至少章节级，优先段落级）
- [ ] 编辑器光标移动时大纲可定位/高亮当前节点（无法判定时不误绑）
- [ ] 绑定失效可观测且可修复，不出现 silent failure
- [ ] 同步逻辑不影响编辑器输入性能

## 参考

- IDE-Advanced 规范：`openspec/specs/sprint-ide-advanced/spec.md`
- Sprint 5：`openspec/specs/sprint-5-project/spec.md`（大纲底座与最小定位要求）
