# Sprint 5：项目管理（2 周）

## Purpose

在 Sprint 5 内交付 WriteNow 的「项目管理」基础能力：以项目为顶层工作单元，提供项目/文件夹结构视图；实现人物设定卡片（UI + 存储）；提供大纲视图（结构化浏览与编辑入口）；并打通知识图谱的数据库 Schema 与基础可视化，为后续“一致性检查/关系推理/时间线”等能力奠定数据与交互底座。

本规范是 `openspec/specs/writenow-spec/spec.md` 在 Sprint 5 范围内的可执行增量（项目管理 + 人物卡 + 大纲 + 知识图谱基础）。

## Requirements

### Requirement: 应用 MUST 支持「项目」作为顶层工作单元，并提供项目/文件夹结构视图

项目（Project）是用户构建“文学世界”的容器：文档、人物卡、大纲、知识图谱等资产 MUST 归属到某个项目，并在 UI 中可被清晰管理与导航。

#### Scenario: 创建 / 打开项目
- **WHEN** 用户创建一个新项目并填写名称（可选：描述、风格指南）
- **THEN** 应创建一条 `projects` 记录，并可在项目列表中再次打开该项目
- **WHEN** 用户选择打开某个项目
- **THEN** 应切换当前工作上下文到该项目（后续资产创建默认归属此项目）

#### Scenario: 项目结构与导航可用
- **WHEN** 用户进入项目视图
- **THEN** 侧边栏必须展示项目结构入口（至少包含：文档/人物/大纲/知识图谱）
- **WHEN** 用户在结构视图中选择任意入口
- **THEN** 主区域应打开对应视图，并保持项目上下文一致（不串项目数据）

---

### Requirement: 人物设定卡片 MUST 支持 CRUD，并与项目关联持久化

人物设定卡片 MUST 以结构化方式存储（支持 traits/relationships JSON），作为项目级上下文的权威来源，并可被 AI 上下文工程与知识图谱复用。

#### Scenario: 人物卡片创建与编辑
- **WHEN** 用户在当前项目中创建一个人物卡片并填写基础信息（name、description 等）
- **THEN** 应写入 `characters` 表，并将 `project_id` 设为当前项目
- **WHEN** 用户编辑人物的性格特点（traits）或人物关系（relationships）
- **THEN** 变更必须持久化保存，重启后仍可恢复

#### Scenario: 人物列表与详情可浏览
- **WHEN** 用户打开人物设定视图
- **THEN** 应展示当前项目下的人物列表（支持搜索/排序为后续扩展点）
- **WHEN** 用户选择某个人物
- **THEN** 应展示人物详情卡片，并允许继续编辑与保存

---

### Requirement: 大纲视图 MUST 提供结构化大纲的浏览与编辑入口

大纲视图 MUST 提供可用的大纲组件，用于结构化呈现文章走向，并为 `context:get_outline` 提供稳定的数据来源（无论底层采用派生或持久化存储策略）。

#### Scenario: 大纲结构可视化
- **WHEN** 用户打开大纲视图并选择当前文章（或在编辑器内打开大纲面板）
- **THEN** 应展示该文章的大纲结构（树状/列表均可，但必须体现层级）
- **WHEN** 用户点击某个大纲节点
- **THEN** 应将编辑器定位到对应章节/段落（若 Sprint 5 不实现精确映射，至少定位到最近标题）

#### Scenario: 大纲修改可持久化
- **WHEN** 用户新增/重命名/调整顺序（最小集合）修改大纲
- **THEN** 修改必须持久化，并在重启后恢复

---

### Requirement: 知识图谱 Schema MUST 支持实体与关系的持久化，并与项目绑定

知识图谱 Schema MUST 建立最小可用的数据库模型：支持实体（人物/地点/事件/时间点/物品）与关系（边）的创建、查询与更新，并为可视化提供稳定数据接口。

#### Scenario: 实体类型可用且可扩展
- **WHEN** 用户在当前项目中创建一个实体（Character/Location/Event/TimePoint/Item）
- **THEN** 数据库必须能持久化实体的 `type/name/description/metadata`（字段名可实现自定，但语义必须覆盖）
- **WHEN** 未来新增实体类型
- **THEN** 不应要求破坏性迁移（至少支持通过枚举扩展或 metadata 承载）

#### Scenario: 关系创建与查询
- **WHEN** 用户在两个实体之间创建关系（如朋友/敌人/参与/发生于等）
- **THEN** 数据库必须能持久化一条关系记录（from/to/type/metadata），并绑定到同一 `project_id`
- **WHEN** 用户打开某个实体详情
- **THEN** 必须能查询并展示该实体关联的关系集合（入边/出边）

---

### Requirement: 知识图谱 UI MUST 提供基础可视化与最小交互

知识图谱 UI MUST 打通“可视化底座”，以便后续在图谱上叠加一致性检查与情节建议；并支持基础的图布局呈现与最小交互（选择/查看/编辑入口）。

#### Scenario: 图谱可浏览
- **WHEN** 用户进入知识图谱视图
- **THEN** 应展示当前项目的节点与边，并支持拖拽平移与缩放
- **WHEN** 用户选择任意节点/边
- **THEN** 应展示其摘要信息（名称、类型、关系等）

#### Scenario: 最小编辑闭环（可选实现策略）
- **WHEN** 用户在图谱中新增节点或新增关系（通过面板或右键菜单等）
- **THEN** 图谱应即时更新，并将变更持久化保存

## Out of Scope（Sprint 5 不包含）

- 知识图谱的自动抽取（从正文自动识别实体/关系）
- 一致性检查、关系推理、时间线自动生成等基于图谱的高级能力
- 大纲生成（AI 生成大纲）与复杂的大纲-正文精确双向绑定
- 项目协作/云同步（属于后续 Sprint）

## Notes（实现约束与建议）

- 数据归属：所有项目级资产（人物/图谱/大纲）必须显式绑定 `project_id`，禁止跨项目混用。
- 渐进式交付：图谱与大纲可先实现“可用的结构化管理”，后续再增强自动化与智能能力。
- 兼容性：Windows 优先，路径与快捷键需兼容 macOS（Cmd 键）。

## References

- 核心规范：`openspec/specs/writenow-spec/spec.md` 第 282-312 行（外挂记忆注入 + 知识图谱实体/关系类型）
- 核心规范：`openspec/specs/writenow-spec/spec.md` 第 775-812 行（数据库 Schema：project_id、projects / characters 表所在段落）
- 核心规范：`openspec/specs/writenow-spec/spec.md` 第 884-889 行（Sprint 5 范围）
